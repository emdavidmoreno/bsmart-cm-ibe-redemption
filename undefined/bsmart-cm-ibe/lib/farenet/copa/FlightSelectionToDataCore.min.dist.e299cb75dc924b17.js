!function(){var a=setInterval(function(){"undefined"!=typeof window.jQuery&&(clearInterval(a),window.Farenet||(window.Farenet=function(){"use strict";function d(a){if(a=JSON.stringify(a),""!=a){b.support.cors=!0;var c="https://datacore-write.securitytrfx.com/w/em_farenet2/1/C0P4BR0W53R";b.ajax({type:"POST",url:c,data:a,script:!0,cache:!1,dataType:"text",headers:{authorization:"40jn178dumy40JN178DVO240jn178dqhs40JN178DQSO"},success:function(a){console.log("Response from our server: "+a)},error:function(a){console.log("There was an error!")}})}}function e(){var r,v,x,a="2.1.0",b={id:"flights.copaair.com",code:"cm"},c=h(),d=i(),e=j(),s=g(),t={},u={},w=[];if(t.language=l(currentLang,current_PoS),t.location=m(e),u.geo=o(e),u.device_category=n(),u.script_filename="cp_v2.6","Multi City"!==e?(r=k(t.language.lang),w=f(r.currency_code)):r={cash:-3,miles:-3,taxes:-3,currency:-3,currency_code:-3,fuel_surcharges:-3},v=q(e,c.type,r.currency_code),x={version:a,airline:b,datasource:c,passengers:d,user_input_journey_type:e,total_price:r,discounts:w,geo:t,departure:v,disclaimer_mapping:s,extra_info:u},"One Way"===e)-1===x.departure[0].dates[0].lowest_price&&(x.total_price.cash=-1);else if("Round Trip"===e)x["return"]=p(c.type,r.currency_code),(-1===x["return"][0].dates[0].lowest_price||-1===x.departure[0].dates[0].lowest_price)&&(x.total_price.cash=-1);else{if("Multi City"!==e)return;for(var y=0;y<v.length;y++)if(-1===x.departure[y].user_input_travel_class)return}return"Round Trip"===e||"One Way"===e?"Panama"!==u.geo[0].origin_country_name&&"Panam\xe1"!==u.geo[0].origin_country_name||u.geo[0].origin_country_name!==u.geo[0].destination_country_name?x.flight_type="International":x.flight_type="Domestic":x.flight_type=-1,x}function f(a){var c=b(".rowDiscount"),d=[];return a&&-1!==a&&-3!==a&&c.each(function(c){var e=b(this).find(".item").text().trim(),f=A(a,b(this).find(".price").text().trim().split(" ")[1]);d.push({name:e,price:f})}),d}function g(){function f(a,c){var d=a.parents().eq(0).clone().children().remove().end().html().trim().split("\n");return a.each(function(a){var e=b(this).text(),f=d[a].trim();","===f[f.length-1]&&(f=f.slice(0,f.length-1)),c[e]={symbol:e,text:f}}),c}var a=b(".footnote"),c=a.find(".refTime"),d=a.find(".ref"),e={};return d.length>0&&(e=f(d,e)),c.length>0&&(e=f(c,e)),e}function h(){var c,a=b("input[name=flexibleSearch]").val();c="true"===a?"flexible-dates":"default";var d={step:"ibe-flight-selection",type:c,url:document.URL,referrer:document.referrer};return d}function i(){var a=b('select[name="guestTypes[0].amount"]').val(),c=b('select[name="guestTypes[1].amount"]').val(),d=b('select[name="guestTypes[2].amount"]').val(),e={user_input_adults:+a,user_input_children:+c,user_input_infants:+d};return e}function j(){var a=b("input[name=tripType]").val();if(a)switch(a){case"OW":a="One Way";break;case"MC":a="Multi City";break;default:a="Round Trip"}return a}function k(a){var i,j,k,c=b("#airSelection_SummaryBot_Bottom_totalPrice span").text().split(" "),d=c[1],e=c[0],f="",g=b(".detailedPrice .price").last().text().trim().split(" ")[1],h=-1,l=b(".detailedPrice tr");return"en"===a?j="Fuel Surcharges":"pt"===a?j="Sobretaxas de combust\xedvel":"es"===a&&(j="Recargos de combustible"),l.each(function(a,c){var d=b(c).text();0!==d.indexOf(j)&&(k=c,i=b(k).find(".money").last())}),i=i?A(e,i.eq(0).text().trim().split(" ")[1]):-1,d=d?A(e,d):-1,g=g?A(e,g):-1,f=B(e),c={cash:d||-1,miles:h,taxes:g||-1,currency:f||-1,currency_code:e||-1,fuel_surcharges:i}}function l(a,b){var c=b.replace("CM","").toLowerCase(),d={};return c=a+"-"+c,d.site_edition=c,d.lang=a,d}function m(a){var c=[];if("One Way"===a||"Round Trip"===a)c.push({user_input_origin_airport_code:b('input[name="outboundOption.originLocationCode"]').val(),user_input_destination_airport_code:b('input[name="outboundOption.destinationLocationCode"]').val()});else if("Multi City"===a)for(var d=0;5>d;d++){var e=b('input[name="multiCityOptions['+d+'].originLocationCode"]').val(),f=b('input[name="multiCityOptions['+d+'].destinationLocationCode"]').val();if(""===e)break;c.push({user_input_origin_airport_code:e,user_input_destination_airport_code:f})}return c}function n(){var a;return a=navigator.userAgent.match(/iPad|PlayBook|Silk/i)?"tablet":navigator.userAgent.match(/Android|webOS|iPhone|iPod|Blackberry|IEMobile|Opera Mini/i)?"mobile":"desktop"}function o(a){function h(a){var f,g,h,j,c=b(a).text().trim().split("-"),d=c[0],e=c[1];return d?(d=d.split(","),f=d[d.length-1].trim(),g=i(d[0])):(f=-1,g=-1),e?(e=e.split(","),h=e[e.length-1].trim(),j=i(e[0])):(h=-1,j=-1),{origin_city_name:g,origin_country_name:f,destination_city_name:j,destination_country_name:h}}function i(a){return a=a.split(" "),delete a[a.length-1],a=a.join(" ").trim()}var d,c=[];if("One Way"===a||"Round Trip"===a)d=h("#headBlock_0"),c.push(d);else if("Multi City"===a)for(var e=0;5>e;e++){var f="#availabilityLeg_"+e+" .headBlock",g=b(f)[0];g&&(d=h(f),c.push(d))}return c}function p(a,b){var c=[];return c.push(v(a,b,'input[name="inboundOption.departureDate"]',"#AIR_SEARCH_RESULT_CONTEXT_ID1")),c}function q(a,c,d){var e=[];if("One Way"===a||"Round Trip"===a)e.push(v(c,d,'input[name="outboundOption.departureDate"]',"#AIR_SEARCH_RESULT_CONTEXT_ID0"));else if("Multi City"===a)for(var f=0;5>f;f++){var g=b("#availabilityLeg_"+f)[0],h={};if(g){var i,j,k=z('input[name="multiCityOptions['+f+'].departureDate"]');h.user_input_date=k,h.dates=[],h.dates.push({date:k,lowest_price:-3,selected:1,flights:[]}),h.dates[0].flights=t(g),0!==h.dates[0].flights.length&&(i=h.dates[0].flights[0].info.classes[0].name,"Economy Promo"===i||"Economy Extra"===i||"Economy Flex"===i||"Economy Class"===i?j="Economy":("Business Promo"===i||"Business Flex"===i)&&(j="Business")),h.user_input_travel_class=i||-1,h.farenet_travel_class=j||-1,e.push(h)}}return e}function s(c){var m,n,d=y(c,".colDeparture .time"),e=y(c,".colArrival .time"),f=b(c).find(".colFlight .flightNum a").text(),g=b(c).find(".colFlight a"),h=-3,i=b(c).find(".colDetails .cabin").text(),j=b(c).find(".colArrival span"),k=b(c).find(".colDeparture div span").last().text().trim(),l=b(c).find(".colArrival div span").last().text().trim(),o=[],p=[],q=[];-1!==k.indexOf("+")&&q.push({id:k,field:"departure_time"}),-1!==l.indexOf("+")&&q.push({id:l,field:"arrival_time"}),j=j.eq(j.length-2).text().split("-"),m=j[0],n=j[1];var r={number:f,departure_time:d,arrival_time:e,duration:h,origin_airport_code:m,destination_airport_code:n,disclaimer:q};a.verbose&&(r.flightNumberHtmlNode=g),o.push(r);var s={name:i,price:{cash:-3,miles:-1},seat:-1};a.verbose&&(s.htmlNode=b(c)),p.push(s);var t={info:{departure_time:d,arrival_time:e,duration:h,flight_list:o,classes:p}};return t}function t(a){var d,c=[],e=b(a).find(".flightLeg");return 0!==e.length&&e.each(function(){var a=b(this),e=a.find("tr");if(e.length>1){for(var f=s(e[0]),g=1;g<e.length;g++)g===e.length-1?(d=s(e[g]),f.info.arrival_time=d.info.arrival_time,f.info.flight_list.push(d.info.flight_list[0])):(d=s(e[g]),f.info.flight_list.push(d.info.flight_list[0]));c.push(f)}else c.push(s(a[0]))}),c}function u(a){var b=a.attr("class").split(" "),c=b.indexOf("colCostNotAvail");c>=0&&(b=[].concat.call([],b.slice(0,c),b.slice(c+1)));var c=b.indexOf("colCostDisabled");c>=0&&(b=[].concat.call([],b.slice(0,c),b.slice(c+1)));var c=b.indexOf("colCostSelected");c>=0&&(b=[].concat.call([],b.slice(0,c),b.slice(c+1)));var d=b,e="."+d.join("."),f=a.closest("table").find("thead "+e+" a").text().trim(),g=d[d.length-1];return{headTitle:f,promoClassName:g}}function v(a,c,d,e){var g,j,m,n,o,f=b(e+" .colCost[rowspan]"),h=[],i="",k=0,l=[];f.each(function(a,c){return b(c).hasClass("colCostNotAvail")?void 0:(f=b(c),!1)});var p=u(f);if(m=p.headTitle,o=p.promoClassName,"colCost_CM_PROMO"===o||"colCost_CM_ECONOMY"===o||"colCost_CM_ECOFLEX"===o?n="Economy":("colCost_CM_PROMOEXEC"===o||"colCost_CM_EXECUTIVE"===o)&&(n="Business"),g=z(d),"default"===a){i=g,k=1;var q=b(e+" .rowOdd").not(".combineRows, .connectedRow");q=q.add(b(e+" .rowEven").not(".combineRows, .connectedRow")),0!==q.length&&q.each(function(){var a=x(this,c);l.push(a)});var r=b(e+" .combineRows").not(".connectedRow");0!==r.length&&r.each(function(){var a=b(this),d=[];if(d.push(this),a.next().hasClass("connectedRow")&&a.next().hasClass("combineRows")){var e;a.hasClass("rowOdd")?(e=a.nextUntil(".rowEven"),e.each(function(){d.push(this)})):a.hasClass("rowEven")&&(e=a.nextUntil(".rowOdd"),e.each(function(){d.push(this)}))}else d.push(a.next()[0]);var f=w(d,c);l.push(f)});var s=b(e+" tbody tr").not("[class]");j=C(s,c);var t={date:i,lowest_price:j||-1,selected:k,flights:l};h.push(t)}else"flexible-dates"===a&&console.log("flexible-dates is not handled");var v={user_input_travel_class:m||-1,farenet_travel_class:n||-1,user_input_date:g,dates:h};return v}function w(a,c){for(var d=x(a[0],c),e=1;e<a.length;e++){var f;if(e===a.length-1){f=x(a[e],c),d.info.arrival_time=f.info.arrival_time,d.info.flight_list.push(f.info.flight_list[0]);var g=b(a[e]).find(".totalTime").text().trim().split(" ");d.info.duration=60*parseInt(g[1])+parseInt(g[2])}else f=x(a[e],c),d.info.flight_list.push(f.info.flight_list[0])}return d}function x(c,d){var e=y(c,".colDepart"),f=y(c,".colArrive"),g=b(c).find(".colDuration").text().trim().split(" "),h=b(c).find(".colFlight a"),i=h.text().trim(),j=b(c).find(".colAirports span"),k=j.eq(0).text(),l=j.eq(1).text(),m=b(c).find(".colFlight sup"),n=b(c).find(".colDepart span").clone().children().remove().end().html(),o=b(c).find(".colArrive span").clone().children().remove().end().html(),p=[];g=60*parseInt(g[0])+parseInt(g[1]),n&&p.push({id:n.trim(),field:"departure_time"}),o&&p.push({id:o.trim(),field:"arrival_time"}),m.length>0&&p.push({id:m.text(),field:"flight_number"});var q={number:i,departure_time:e,arrival_time:f,duration:g,origin_airport_code:k,destination_airport_code:l,disclaimer:p};a.verbose&&(q.flightNumberHtmlNode=h);var r=[];r.push(q);var s=[],t=b(c).find(".colCost1, .colCost2, .colCost3, .colCost4, .colCost5");t.each(function(c,e){var f="",g={cash:-1,miles:-1,cash_after_discount:-1},h=-1;f=u(b(e)).headTitle;var i=b(this);i.hasClass("colCostNotAvail")||(i=i.text().trim().split("\n"),g.cash=A(d,i[0]),b(this).find(".newPrice").length>0&&(g.cash_after_discount=A(d,i[1].trim())),h=i[i.length-1].trim().split(" ")[0],h=isNaN(h)?-2:+h);var j={name:f,price:g,seat:h};a.verbose&&(j.htmlNode=b(this)),s.push(j)});var v={info:{departure_time:e,arrival_time:f,duration:g,flight_list:r,classes:s}};return v}function y(a,c){var e,d=b(a).find(c).text().trim();return-1!==d.indexOf("+")&&-1===d.indexOf("M")?e=d.split("+")[0]:-1!==d.indexOf("M")?(-1!==d.indexOf("+")&&(d=d.split("+")[0]),d=d.split(" "),e=d[0].split(":"),"PM"===d[1]?(e[0]=+e[0],e[0]+=12,24===e[0]&&(e[0]="12"),e=e[0]+":"+e[1]):("12"===e[0]&&(e[0]="00"),e=e[0]+":"+e[1])):e=d,e}function z(a){var c=b(a).val().split("/");return c=c[2]+"-"+c[0]+"-"+c[1]}function A(a,b){var c;if(b)switch(a){case"BRL":c=+b.replace(/\./g,"").replace(",",".");break;case"CAD":c=+b.replace(/\,/g,"");break;case"COP":c=+b.replace(/\./g,"");break;case"CLP":c=+b.replace(/\,/g,"");break;default:c=+b.replace(/\,/g,"")}return c}function B(a){var b;if(a)switch(a){case"BRL":b="R$";break;case"CAD":b="C$";break;case"COP":b="COL$";break;case"CLP":b="CLP$";break;default:b="$"}return b}function C(a,c){var d=0;return a.each(function(){var a=b(this);a=a.text().trim().split("\n"),a=A(c,a[0]),0===d?d=a:d>a&&(d=a)}),d}var a={},b=window.jQuery;return a.sendFlag=1,a.getResult=function(){var b=a.parse();return b},a.parseAndSend=function(){var c=a.parse();1==a.sendFlag&&c&&"object"==typeof c&&(d(c),b(window).trigger("parse:completed",{page:"flight_selection",result:c}),a.sendFlag=0)},a.parse=function(){try{var b=e();return a.verbose=0,b}catch(c){console.log("There was an error: "+c)}},a.parseAndSend(),a}()))},300)}();